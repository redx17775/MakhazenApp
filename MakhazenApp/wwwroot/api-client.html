<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Makhazen API Client - Remote Web Application</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            padding-top: 20px;
        }
        .api-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .api-url {
            font-family: monospace;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
        }
        .result-area {
            max-height: 400px;
            overflow-y: auto;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin-top: 15px;
        }
        .product-card, .category-card {
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 10px;
            background: white;
        }
        .btn-action {
            margin: 2px;
        }
        .search-form {
            background: #e9ecef;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 15px;
        }
        .status-badge {
            font-size: 0.75rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row mb-4">
            <div class="col-12">
                <h1 class="text-center"><i class="bi bi-cloud-arrow-up"></i> Makhazen API Client</h1>
                <p class="text-center text-muted">Remote Web Application for API Interaction</p>
            </div>
        </div>

        <!-- API Configuration -->
        <div class="api-section">
            <h3><i class="bi bi-gear"></i> API Configuration</h3>
            <div class="mb-3">
                <label for="apiBaseUrl" class="form-label">API Base URL:</label>
                <input type="text" class="form-control" id="apiBaseUrl" 
                       value="https://localhost:5001/api" 
                       placeholder="https://localhost:5001/api">
                <small class="text-muted">Change this to point to your API server</small>
            </div>
        </div>

        <!-- Products Section -->
        <div class="api-section">
            <h3><i class="bi bi-box-seam"></i> Products Management</h3>
            
            <!-- Search Form -->
            <div class="search-form">
                <h5>Search Products</h5>
                <div class="row g-3">
                    <div class="col-md-4">
                        <input type="text" class="form-control" id="searchProductName" placeholder="Product Name">
                    </div>
                    <div class="col-md-4">
                        <input type="text" class="form-control" id="searchCategory" placeholder="Category">
                    </div>
                    <div class="col-md-4">
                        <button class="btn btn-primary w-100" onclick="searchProducts()">
                            <i class="bi bi-search"></i> Search
                        </button>
                    </div>
                </div>
                <div class="mt-2">
                    <button class="btn btn-secondary btn-sm" onclick="loadAllProducts()">
                        <i class="bi bi-list"></i> Load All Products
                    </button>
                    <button class="btn btn-success btn-sm" onclick="showAddProductForm()">
                        <i class="bi bi-plus-circle"></i> Add New Product
                    </button>
                </div>
            </div>

            <!-- Add/Edit Product Form -->
            <div id="productForm" style="display: none;" class="mt-3">
                <h5 id="productFormTitle">Add Product</h5>
                <form id="productFormElement">
                    <input type="hidden" id="productId">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">Name *</label>
                            <input type="text" class="form-control" id="productName" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Code *</label>
                            <input type="text" class="form-control" id="productCode" required pattern="[A-Z0-9\-]{3,20}">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Category</label>
                            <select class="form-select" id="productCategoryId">
                                <option value="">Loading...</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Price</label>
                            <input type="number" class="form-control" id="productPrice" step="0.01" min="0">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Stock</label>
                            <input type="number" class="form-control" id="productStock" min="0">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Photo URL</label>
                            <input type="url" class="form-control" id="productPhotoUrl">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Status</label>
                            <select class="form-select" id="productStatus">
                                <option value="InStock">In Stock</option>
                                <option value="OutOfStock">Out of Stock</option>
                                <option value="Discontinued">Discontinued</option>
                            </select>
                        </div>
                    </div>
                    <div class="mt-3">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-save"></i> Save Product
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="hideProductForm()">Cancel</button>
                    </div>
                </form>
            </div>

            <!-- Results -->
            <div id="productsResult" class="result-area"></div>
        </div>

        <!-- Categories Section -->
        <div class="api-section">
            <h3><i class="bi bi-tags"></i> Categories Management</h3>
            
            <!-- Search Form -->
            <div class="search-form">
                <h5>Search Categories</h5>
                <div class="row g-3">
                    <div class="col-md-8">
                        <input type="text" class="form-control" id="searchCategoryName" placeholder="Category Name">
                    </div>
                    <div class="col-md-4">
                        <button class="btn btn-primary w-100" onclick="searchCategories()">
                            <i class="bi bi-search"></i> Search
                        </button>
                    </div>
                </div>
                <div class="mt-2">
                    <button class="btn btn-secondary btn-sm" onclick="loadAllCategories()">
                        <i class="bi bi-list"></i> Load All Categories
                    </button>
                    <button class="btn btn-success btn-sm" onclick="showAddCategoryForm()">
                        <i class="bi bi-plus-circle"></i> Add New Category
                    </button>
                </div>
            </div>

            <!-- Add/Edit Category Form -->
            <div id="categoryForm" style="display: none;" class="mt-3">
                <h5 id="categoryFormTitle">Add Category</h5>
                <form id="categoryFormElement">
                    <input type="hidden" id="categoryId">
                    <div class="row g-3">
                        <div class="col-md-8">
                            <label class="form-label">Category Name *</label>
                            <input type="text" class="form-control" id="categoryName" required>
                        </div>
                    </div>
                    <div class="mt-3">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-save"></i> Save Category
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="hideCategoryForm()">Cancel</button>
                    </div>
                </form>
            </div>

            <!-- Results -->
            <div id="categoriesResult" class="result-area"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // API Service
        const API = {
            baseUrl: () => document.getElementById('apiBaseUrl').value || 'https://localhost:5001/api',
            
            async request(endpoint, method = 'GET', body = null) {
                const url = `${this.baseUrl()}${endpoint}`;
                const options = {
                    method,
                    headers: {
                        'Content-Type': 'application/json',
                    }
                };
                
                if (body) {
                    options.body = JSON.stringify(body);
                }
                
                try {
                    const response = await fetch(url, options);
                    const data = await response.json();
                    
                    if (!response.ok) {
                        throw new Error(data.error || `HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    return data;
                } catch (error) {
                    throw error;
                }
            },
            
            // Products
            async getAllProducts() {
                return this.request('/ProductApi');
            },
            
            async getProductById(id) {
                return this.request(`/ProductApi/${id}`);
            },
            
            async getProductByCode(code) {
                return this.request(`/ProductApi/code/${code}`);
            },
            
            async searchProducts(name, category) {
                const params = new URLSearchParams();
                if (name) params.append('name', name);
                if (category) params.append('category', category);
                return this.request(`/ProductApi/search?${params.toString()}`);
            },
            
            async createProduct(product) {
                return this.request('/ProductApi', 'POST', product);
            },
            
            async updateProduct(id, product) {
                return this.request(`/ProductApi/${id}`, 'PUT', product);
            },
            
            async deleteProduct(id) {
                return this.request(`/ProductApi/${id}`, 'DELETE');
            },
            
            // Categories
            async getAllCategories() {
                return this.request('/CategoriesApi');
            },
            
            async getCategoryById(id) {
                return this.request(`/CategoriesApi/${id}`);
            },
            
            async searchCategories(name) {
                const params = new URLSearchParams();
                if (name) params.append('name', name);
                return this.request(`/CategoriesApi/search?${params.toString()}`);
            },
            
            async createCategory(category) {
                return this.request('/CategoriesApi', 'POST', category);
            },
            
            async updateCategory(id, category) {
                return this.request(`/CategoriesApi/${id}`, 'PUT', category);
            },
            
            async deleteCategory(id) {
                return this.request(`/CategoriesApi/${id}`, 'DELETE');
            },
            
            async getProductsByCategory(id) {
                return this.request(`/CategoriesApi/${id}/products`);
            }
        };

        // UI Functions - Products
        async function loadAllProducts() {
            try {
                showLoading('productsResult');
                const products = await API.getAllProducts();
                displayProducts(products);
            } catch (error) {
                showError('productsResult', error.message);
            }
        }

        async function searchProducts() {
            try {
                const name = document.getElementById('searchProductName').value;
                const category = document.getElementById('searchCategory').value;
                showLoading('productsResult');
                const products = await API.searchProducts(name, category);
                displayProducts(products);
            } catch (error) {
                showError('productsResult', error.message);
            }
        }

        function displayProducts(products) {
            const resultDiv = document.getElementById('productsResult');
            if (!products || products.length === 0) {
                resultDiv.innerHTML = '<p class="text-muted">No products found.</p>';
                return;
            }
            
            resultDiv.innerHTML = `
                <h6>Found ${products.length} product(s):</h6>
                ${products.map(p => `
                    <div class="product-card">
                        <div class="row">
                            <div class="col-md-8">
                                <h6>${p.name}</h6>
                                <p class="mb-1"><strong>Code:</strong> ${p.code}</p>
                                <p class="mb-1"><strong>Category:</strong> ${p.category || 'N/A'}</p>
                                <p class="mb-1"><strong>Price:</strong> $${p.price.toFixed(2)}</p>
                                <p class="mb-1"><strong>Stock:</strong> ${p.stock}</p>
                                <span class="badge bg-${p.status === 'InStock' ? 'success' : 'warning'} status-badge">${p.status}</span>
                            </div>
                            <div class="col-md-4 text-end">
                                <button class="btn btn-sm btn-primary btn-action" onclick="editProduct(${p.id})">
                                    <i class="bi bi-pencil"></i> Edit
                                </button>
                                <button class="btn btn-sm btn-danger btn-action" onclick="deleteProduct(${p.id})">
                                    <i class="bi bi-trash"></i> Delete
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('')}
            `;
        }

        async function editProduct(id) {
            try {
                const product = await API.getProductById(id);
                document.getElementById('productId').value = product.id;
                document.getElementById('productName').value = product.name;
                document.getElementById('productCode').value = product.code;
                document.getElementById('productCategoryId').value = product.categoryId || '';
                document.getElementById('productPrice').value = product.price;
                document.getElementById('productStock').value = product.stock;
                document.getElementById('productPhotoUrl').value = product.photoUrl || '';
                document.getElementById('productStatus').value = product.status || 'InStock';
                document.getElementById('productFormTitle').textContent = 'Edit Product';
                document.getElementById('productForm').style.display = 'block';
                loadCategoriesForSelect();
            } catch (error) {
                alert('Error loading product: ' + error.message);
            }
        }

        async function deleteProduct(id) {
            if (!confirm('Are you sure you want to delete this product?')) return;
            
            try {
                await API.deleteProduct(id);
                alert('Product deleted successfully!');
                loadAllProducts();
            } catch (error) {
                alert('Error deleting product: ' + error.message);
            }
        }

        function showAddProductForm() {
            document.getElementById('productFormElement').reset();
            document.getElementById('productId').value = '';
            document.getElementById('productFormTitle').textContent = 'Add Product';
            document.getElementById('productForm').style.display = 'block';
            loadCategoriesForSelect();
        }

        function hideProductForm() {
            document.getElementById('productForm').style.display = 'none';
        }

        async function loadCategoriesForSelect() {
            try {
                const categories = await API.getAllCategories();
                const select = document.getElementById('productCategoryId');
                select.innerHTML = '<option value="">Select Category</option>' +
                    categories.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
            } catch (error) {
                console.error('Error loading categories:', error);
            }
        }

        document.getElementById('productFormElement').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const product = {
                name: document.getElementById('productName').value,
                code: document.getElementById('productCode').value,
                categoryId: parseInt(document.getElementById('productCategoryId').value) || 0,
                price: parseFloat(document.getElementById('productPrice').value) || 0,
                stock: parseInt(document.getElementById('productStock').value) || 0,
                photoUrl: document.getElementById('productPhotoUrl').value || null,
                status: document.getElementById('productStatus').value || 'InStock'
            };
            
            try {
                const productId = document.getElementById('productId').value;
                if (productId) {
                    await API.updateProduct(parseInt(productId), product);
                    alert('Product updated successfully!');
                } else {
                    await API.createProduct(product);
                    alert('Product created successfully!');
                }
                hideProductForm();
                loadAllProducts();
            } catch (error) {
                alert('Error saving product: ' + error.message);
            }
        });

        // UI Functions - Categories
        async function loadAllCategories() {
            try {
                showLoading('categoriesResult');
                const categories = await API.getAllCategories();
                displayCategories(categories);
            } catch (error) {
                showError('categoriesResult', error.message);
            }
        }

        async function searchCategories() {
            try {
                const name = document.getElementById('searchCategoryName').value;
                showLoading('categoriesResult');
                const categories = await API.searchCategories(name);
                displayCategories(categories);
            } catch (error) {
                showError('categoriesResult', error.message);
            }
        }

        function displayCategories(categories) {
            const resultDiv = document.getElementById('categoriesResult');
            if (!categories || categories.length === 0) {
                resultDiv.innerHTML = '<p class="text-muted">No categories found.</p>';
                return;
            }
            
            resultDiv.innerHTML = `
                <h6>Found ${categories.length} category(ies):</h6>
                ${categories.map(c => `
                    <div class="category-card">
                        <div class="row">
                            <div class="col-md-8">
                                <h6>${c.name}</h6>
                                <p class="mb-0"><strong>ID:</strong> ${c.id}</p>
                            </div>
                            <div class="col-md-4 text-end">
                                <button class="btn btn-sm btn-primary btn-action" onclick="editCategory(${c.id})">
                                    <i class="bi bi-pencil"></i> Edit
                                </button>
                                <button class="btn btn-sm btn-info btn-action" onclick="viewCategoryProducts(${c.id})">
                                    <i class="bi bi-box"></i> Products
                                </button>
                                <button class="btn btn-sm btn-danger btn-action" onclick="deleteCategory(${c.id})">
                                    <i class="bi bi-trash"></i> Delete
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('')}
            `;
        }

        async function editCategory(id) {
            try {
                const category = await API.getCategoryById(id);
                document.getElementById('categoryId').value = category.id;
                document.getElementById('categoryName').value = category.name;
                document.getElementById('categoryFormTitle').textContent = 'Edit Category';
                document.getElementById('categoryForm').style.display = 'block';
            } catch (error) {
                alert('Error loading category: ' + error.message);
            }
        }

        async function deleteCategory(id) {
            if (!confirm('Are you sure you want to delete this category?')) return;
            
            try {
                await API.deleteCategory(id);
                alert('Category deleted successfully!');
                loadAllCategories();
            } catch (error) {
                alert('Error deleting category: ' + error.message);
            }
        }

        async function viewCategoryProducts(id) {
            try {
                showLoading('productsResult');
                const result = await API.getProductsByCategory(id);
                displayProducts(result.products || []);
                alert(`Category "${result.category.name}" has ${result.count} product(s)`);
            } catch (error) {
                alert('Error loading category products: ' + error.message);
            }
        }

        function showAddCategoryForm() {
            document.getElementById('categoryFormElement').reset();
            document.getElementById('categoryId').value = '';
            document.getElementById('categoryFormTitle').textContent = 'Add Category';
            document.getElementById('categoryForm').style.display = 'block';
        }

        function hideCategoryForm() {
            document.getElementById('categoryForm').style.display = 'none';
        }

        document.getElementById('categoryFormElement').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const category = {
                name: document.getElementById('categoryName').value
            };
            
            try {
                const categoryId = document.getElementById('categoryId').value;
                if (categoryId) {
                    await API.updateCategory(parseInt(categoryId), category);
                    alert('Category updated successfully!');
                } else {
                    await API.createCategory(category);
                    alert('Category created successfully!');
                }
                hideCategoryForm();
                loadAllCategories();
                loadCategoriesForSelect(); // Refresh product form dropdown
            } catch (error) {
                alert('Error saving category: ' + error.message);
            }
        });

        // Utility Functions
        function showLoading(elementId) {
            document.getElementById(elementId).innerHTML = '<div class="text-center"><div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div></div>';
        }

        function showError(elementId, message) {
            document.getElementById(elementId).innerHTML = `<div class="alert alert-danger"><i class="bi bi-exclamation-triangle"></i> ${message}</div>`;
        }

        // Initialize on page load
        window.addEventListener('load', () => {
            loadAllProducts();
            loadAllCategories();
        });
    </script>
</body>
</html>

